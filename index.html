<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>iPad ç”µè„‘é¥æ§å™¨ Â· è§¦æ§ä¸“äº«</title>
    <style>
        * {
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }
        body {
            min-height: 100vh;
            margin: 0;
            background: #0b1117;
            background: radial-gradient(circle at 30% 20%, #1e2c38, #0a121b);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 12px;
            /* é€‚é… iPad å¤§å±ä¹Ÿèˆ’é€‚ */
        }
        .remote-container {
            max-width: 1200px;
            width: 100%;
            background: rgba(18, 28, 36, 0.9);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(64, 164, 235, 0.3);
            border-radius: 48px;
            padding: 22px;
            box-shadow: 0 30px 50px rgba(0, 0, 0, 0.8), 0 0 0 2px rgba(0, 150, 255, 0.2) inset;
        }

        /* ----- è¢«æ§ç”»é¢ (iPad ä¸Šæ›´æ¸…æ™°) ----- */
        .screen-section {
            margin-bottom: 22px;
        }
        .screen-label {
            flex-direction: row;
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
            padding-left: 8px;
        }
        .screen-label span {
            color: #cceaff;
            font-weight: 500;
            font-size: 0.9rem;
            background: #0f2635;
            padding: 5px 16px;
            border-radius: 40px;
            border: 1px solid #31799b;
            letter-spacing: 0.3px;
        }
        .live-screen {
            background: #0c1922;
            border-radius: 38px;
            border: 3px solid #1f4b64;
            box-shadow: 0 0 35px rgba(0, 170, 255, 0.25);
            aspect-ratio: 16 / 9;
            width: 100%;
            position: relative;
            overflow: hidden;
            transition: border 0.2s;
        }
        .live-screen.touch-active {
            border-color: #00c8ff;
            box-shadow: 0 0 45px #00b3ff;
        }
        .screen-canvas {
            width: 100%;
            height: 100%;
            display: block;
            background: #0d1a24;
            background-image: 
                linear-gradient(rgba(0, 210, 255, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 210, 255, 0.03) 1px, transparent 1px);
            background-size: 45px 45px;
            background-position: center;
        }
        /* è§¦æ§å…‰æ ‡ (iPad ä¸Šè¦å¤§ä¸€ç‚¹) */
        .cursor-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }
        .remote-cursor {
            position: absolute;
            width: 32px;
            height: 32px;
            background: rgba(255, 80, 130, 0.95);
            border: 3px solid white;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            box-shadow: 0 0 25px #ff99bb;
            transition: all 0.02s linear;
            pointer-events: none;
            z-index: 25;
        }
        .remote-cursor::after {
            content: "â—";
            position: absolute;
            top: -26px;
            left: 10px;
            color: white;
            font-size: 28px;
            text-shadow: 0 2px 6px black;
            transform: scale(0.9);
        }
        .screen-footer {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            padding: 0 12px;
            color: #7c9eb3;
            font-size: 0.85rem;
            font-weight: 400;
        }
        .badge {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .led {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #555;
        }
        .led.green {
            background: #1effb0;
            box-shadow: 0 0 18px #0affb0;
        }

        /* ----- è§¦æ§é¢æ¿ (é’ˆå¯¹æ‰‹æŒ‡ä¼˜åŒ–) ----- */
        .control-panel {
            background: #101e2b;
            border-radius: 42px;
            padding: 28px 20px;
            border: 1px solid #2e6280;
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
        }

        .panel-title {
            color: #b5defa;
            font-weight: 500;
            font-size: 1.3rem;
            letter-spacing: 0.5px;
            border-bottom: 2px solid #2b6c8f;
            padding-bottom: 8px;
            margin-bottom: 18px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        /* è§¦æ§æ¿åŒºåŸŸ - å¤§å°ºå¯¸é€‚åˆæ‰‹æŒ‡æ»‘åŠ¨ */
        .touchpad-section {
            margin-bottom: 28px;
        }
        .touchpad-container {
            background: #0c1f2d;
            border-radius: 42px;
            padding: 18px;
            border: 2px solid #256882;
            box-shadow: inset 0 4px 12px #00000080, 0 12px 20px #00000060;
        }
        .touchpad-surface {
            background: #153546;
            border-radius: 36px;
            height: 240px;  /* è¶³å¤Ÿé«˜ï¼Œæ‰‹æŒ‡æ»‘åŠ¨èˆ’æœ */
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            border: 2px solid #2d779b;
            box-shadow: 0 0 0 3px #0d202b inset;
            touch-action: none;  /* ç¦æ­¢æµè§ˆå™¨æ»šåŠ¨/ç¼©æ”¾ */
            background-image: radial-gradient(circle at 30px 40px, #3e6f8f 2px, transparent 2px);
            background-size: 65px 65px;
        }
        .touch-hint {
            color: #beddf5;
            background: #08212ec4;
            padding: 12px 28px;
            border-radius: 60px;
            font-size: 1.3rem;
            font-weight: 500;
            border: 1px solid #42b0e6;
            backdrop-filter: blur(4px);
            pointer-events: none;
        }

        /* é¼ æ ‡æŒ‰é’® - åŠ å¤§ï¼Œæ–¹ä¾¿æ‰‹æŒ‡ç‚¹æŒ‰ */
        .mouse-buttons {
            display: flex;
            gap: 22px;
            margin-top: 22px;
            justify-content: center;
        }
        .btn-mouse {
            background: #1d3d54;
            border: none;
            border-bottom: 6px solid #0a1c2a;
            color: white;
            font-size: 1.6rem;
            font-weight: 600;
            padding: 24px 10px;
            border-radius: 80px;
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 14px;
            box-shadow: 0 12px 0 #08212b;
            transition: 0.06s;
            cursor: pointer;
            touch-action: manipulation;
        }
        .btn-mouse:active {
            transform: translateY(8px);
            box-shadow: 0 4px 0 #08212b;
            border-bottom-width: 3px;
        }
        .btn-mouse.right {
            background: #264c61;
        }

        /* ----- é”®ç›˜ (iPad å¤§æŒ‰é’®) ----- */
        .keyboard-section {
            margin-top: 28px;
        }
        .keyboard-grid {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        .key-row {
            display: flex;
            gap: 12px;
            justify-content: center;
            flex-wrap: wrap;
        }
        .key {
            background: #1e3d54;
            border-radius: 26px;
            padding: 20px 0;
            flex: 1 0 auto;
            min-width: 70px;
            text-align: center;
            color: #ecf9ff;
            font-weight: 600;
            font-size: 1.5rem;
            box-shadow: 0 7px 0 #102634, 0 6px 16px black;
            border-bottom: 3px solid #2b799b;
            transition: 0.05s;
            cursor: pointer;
            touch-action: manipulation;
        }
        .key.special {
            background: #274f69;
            font-size: 1.3rem;
            flex: 1.3;
        }
        .key.space {
            flex: 5;
            min-width: 180px;
        }
        .key:active {
            transform: translateY(6px);
            box-shadow: 0 2px 0 #102634;
            border-bottom-width: 1px;
            background: #2f6682;
        }

        /* å®å‘½ä»¤å¤§æŒ‰é’® */
        .macro-row {
            display: flex;
            gap: 16px;
            margin-top: 32px;
            flex-wrap: wrap;
        }
        .macro-btn {
            background: #114155;
            border: 2px solid #2ba0cc;
            color: #e0f3ff;
            padding: 24px 20px;
            border-radius: 60px;
            font-size: 1.5rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 16px;
            box-shadow: 0 12px 0 #09303f;
            cursor: pointer;
            transition: 0.06s;
            flex: 1;
            touch-action: manipulation;
            min-width: 180px;
        }
        .macro-btn:active {
            transform: translateY(8px);
            box-shadow: 0 4px 0 #09303f;
        }
        .macro-btn.red {
            background: #623b44;
            border-color: #dd7f97;
            color: #ffd9e2;
        }

        .footer-note {
            margin-top: 30px;
            text-align: center;
            color: #3d708b;
            font-size: 1rem;
        }
        /* iPad æ¨ªå±ä¸‹å¾®è°ƒ */
        @media (orientation: landscape) and (min-width: 1024px) {
            .touchpad-surface {
                height: 280px;
            }
            .key {
                padding: 24px 0;
                font-size: 1.7rem;
            }
        }
    </style>
</head>
<body>
<div class="remote-container">
    <!-- ç”»é¢æ¨¡æ‹Ÿ (ç”µè„‘å±å¹•) -->
    <div class="screen-section">
        <div class="screen-label">
            <span>ğŸ’» è¿œç¨‹ç”µè„‘ (iPad è§¦æ§æ“æ§)</span>
        </div>
        <div class="live-screen" id="liveScreen">
            <canvas id="screenCanvas" class="screen-canvas" width="1280" height="720"></canvas>
            <div class="cursor-overlay" id="cursorOverlay">
                <div class="remote-cursor" id="remoteCursor" style="left: 50%; top: 50%;"></div>
            </div>
        </div>
        <div class="screen-footer">
            <div class="badge"><span class="led green"></span> å·²è¿æ¥ (æ¨¡æ‹Ÿ) Â· iPad</div>
            <div class="badge">ğŸ“± æ»‘åŠ¨è§¦æ‘¸æ¿ç§»åŠ¨å…‰æ ‡</div>
        </div>
    </div>

    <!-- æ§åˆ¶åŒºåŸŸ 100% è§¦æ§å‹å¥½ -->
    <div class="control-panel">
        <!-- è§¦æ§æ¿ + å·¦å³é”® (ä¸»è¦è§¦æ§åŒº) -->
        <div class="touchpad-section">
            <div class="panel-title">ğŸ–ï¸ è§¦æ§æ¿ Â· æ‰‹æŒ‡æ»‘åŠ¨</div>
            <div class="touchpad-container">
                <div class="touchpad-surface" id="touchpadSurface">
                    <span class="touch-hint" id="touchpadHint">â† æ‹–æ‹½ç§»åŠ¨å…‰æ ‡ â†’</span>
                </div>
                <div class="mouse-buttons">
                    <button class="btn-mouse" id="leftClickBtn"><span>ğŸ–±ï¸ å·¦é”®</span></button>
                    <button class="btn-mouse right" id="rightClickBtn"><span>ğŸ” å³é”®</span></button>
                </div>
            </div>
        </div>

        <!-- å¸¸ç”¨é”®ç›˜ (å¤§æŒ‰é’®å¸ƒå±€) -->
        <div class="keyboard-section">
            <div class="panel-title">âŒ¨ï¸ é”®ç›˜ (è½»è§¦æ¨¡æ‹Ÿ)</div>
            <div class="keyboard-grid">
                <div class="key-row">
                    <div class="key special" data-key="Esc">Esc</div>
                    <div class="key special" data-key="Tab">Tab</div>
                    <div class="key special" data-key="Ctrl">Ctrl</div>
                    <div class="key special" data-key="Alt">Alt</div>
                </div>
                <div class="key-row">
                    <div class="key" data-key="q">Q</div>
                    <div class="key" data-key="w">W</div>
                    <div class="key" data-key="e">E</div>
                    <div class="key" data-key="r">R</div>
                    <div class="key" data-key="t">T</div>
                    <div class="key" data-key="y">Y</div>
                    <div class="key" data-key="u">U</div>
                    <div class="key" data-key="i">I</div>
                </div>
                <div class="key-row">
                    <div class="key" data-key="a">A</div>
                    <div class="key" data-key="s">S</div>
                    <div class="key" data-key="d">D</div>
                    <div class="key" data-key="f">F</div>
                    <div class="key" data-key="g">G</div>
                    <div class="key" data-key="h">H</div>
                    <div class="key" data-key="j">J</div>
                    <div class="key" data-key="k">K</div>
                </div>
                <div class="key-row">
                    <div class="key" data-key="z">Z</div>
                    <div class="key" data-key="x">X</div>
                    <div class="key" data-key="c">C</div>
                    <div class="key" data-key="v">V</div>
                    <div class="key" data-key="b">B</div>
                    <div class="key" data-key="n">N</div>
                    <div class="key" data-key="m">M</div>
                </div>
                <div class="key-row">
                    <div class="key special" data-key="Shift">Shift</div>
                    <div class="key space" data-key=" ">ç©ºæ ¼</div>
                    <div class="key special" data-key="Enter">â†µ Enter</div>
                </div>
            </div>
        </div>

        <!-- ç³»ç»ŸæŒ‡ä»¤ -->
        <div class="macro-row">
            <button class="macro-btn" id="screenshotBtn"><span>ğŸ“¸ æˆªå±</span></button>
            <button class="macro-btn" id="lockPcBtn"><span>ğŸ”’ é”å®šç”µè„‘</span></button>
            <button class="macro-btn red" id="shutdownBtn"><span>â» å…³æœºæ¨¡æ‹Ÿ</span></button>
        </div>
    </div>
    <div class="footer-note">
        âš¡ é€šè¿‡ WebSocket æ§åˆ¶ç”µè„‘ (æ¨¡æ‹ŸæŒ‡ä»¤å‘é€ï¼Œå¯æ›¿æ¢ä¸ºçœŸå®åç«¯)
    </div>
</div>

<script>
    (function() {
        // --- æ¨¡æ‹Ÿ WebSocket ï¼ˆå®é™…ä½¿ç”¨æ—¶æ›¿æ¢ä¸ºçœŸå®WebSocketï¼‰---
        const ws = {
            send: (message) => {
                console.log('ğŸ“² [iPadâ†’ç”µè„‘]', JSON.stringify(message));
                // åœ¨è¿™é‡Œå¯ä»¥æ¢æˆå®é™…WebSocketå‘é€
                // ä¾‹å¦‚ realWS.send(JSON.stringify(message));
                updateRemoteCursorFromMessage(message);
                simulateEffect(message);
            }
        };

        // UI å…ƒç´ 
        const touchSurface = document.getElementById('touchpadSurface');
        const cursor = document.getElementById('remoteCursor');
        const liveScreen = document.getElementById('liveScreen');
        const leftBtn = document.getElementById('leftClickBtn');
        const rightBtn = document.getElementById('rightClickBtn');
        const hint = document.getElementById('touchpadHint');
        const screenshotBtn = document.getElementById('screenshotBtn');
        const lockBtn = document.getElementById('lockPcBtn');
        const shutdownBtn = document.getElementById('shutdownBtn');

        // å…‰æ ‡å½’ä¸€åŒ–ä½ç½® (0~1)
        let cursorNormX = 0.5, cursorNormY = 0.5;

        // æ›´æ–°å…‰æ ‡åœ¨ç”»é¢ä¸Šçš„ä½ç½®
        function setCursorPosition(xNorm, yNorm) {
            const screenRect = liveScreen.getBoundingClientRect();
            const x = Math.min(screenRect.width, Math.max(0, xNorm * screenRect.width));
            const y = Math.min(screenRect.height, Math.max(0, yNorm * screenRect.height));
            cursor.style.left = x + 'px';
            cursor.style.top = y + 'px';
            cursorNormX = xNorm;
            cursorNormY = yNorm;
        }

        // åˆå§‹å±…ä¸­
        setCursorPosition(0.5, 0.5);

        // --- è§¦æ§æ¿ç›¸å¯¹æ»‘åŠ¨ (æ”¯æŒå¤šæŒ‡/å•æŒ‡) ---
        let isTouching = false;
        let lastTouchX = 0, lastTouchY = 0;

        function handleTouchStart(e) {
            e.preventDefault();
            const touch = e.touches[0];
            if (!touch) return;
            isTouching = true;
            lastTouchX = touch.clientX;
            lastTouchY = touch.clientY;
            hint.innerText = 'ğŸ‘† æ­£åœ¨ç§»åŠ¨å…‰æ ‡';
            liveScreen.classList.add('touch-active');
        }

        function handleTouchMove(e) {
            e.preventDefault();
            if (!isTouching) return;
            const touch = e.touches[0];
            if (!touch) return;

            const dx = touch.clientX - lastTouchX;
            const dy = touch.clientY - lastTouchY;

            // çµæ•åº¦è°ƒèŠ‚ (é€‚åˆiPadå¤§å±ï¼Œç³»æ•°ç¨ä½ï¼Œç§»åŠ¨æ›´ç²¾å‡†)
            const sens = 0.004;
            let newX = cursorNormX + dx * sens;
            let newY = cursorNormY + dy * sens;
            newX = Math.min(1, Math.max(0, newX));
            newY = Math.min(1, Math.max(0, newY));

            // å‘é€ç§»åŠ¨æŒ‡ä»¤
            ws.send({
                type: 'mouse-move',
                x: newX,
                y: newY,
                dx: dx,
                dy: dy,
                source: 'ipad-touchpad'
            });

            // æ›´æ–°å…‰æ ‡æ˜¾ç¤º
            setCursorPosition(newX, newY);

            lastTouchX = touch.clientX;
            lastTouchY = touch.clientY;
        }

        function handleTouchEnd(e) {
            e.preventDefault();
            isTouching = false;
            hint.innerText = 'â† æ‹–æ‹½ç§»åŠ¨å…‰æ ‡ â†’';
            liveScreen.classList.remove('touch-active');
        }

        // ç»‘å®šè§¦æ‘¸äº‹ä»¶
        touchSurface.addEventListener('touchstart', handleTouchStart, { passive: false });
        touchSurface.addEventListener('touchmove', handleTouchMove, { passive: false });
        touchSurface.addEventListener('touchend', handleTouchEnd);
        touchSurface.addEventListener('touchcancel', handleTouchEnd);

        // é˜²æ­¢é¼ æ ‡äº‹ä»¶å¹²æ‰°(ä½†ä¿ç•™é¼ æ ‡è°ƒè¯•)
        touchSurface.addEventListener('mousedown', (e) => {
            e.preventDefault();
        });

        // --- é¼ æ ‡å·¦å³é”® (è§¦æ‘¸ç‰ˆ) ---
        function setButtonActive(btn, active) {
            if (active) {
                btn.style.transform = 'translateY(8px)';
                btn.style.boxShadow = '0 4px 0 #08212b';
            } else {
                btn.style.transform = '';
                btn.style.boxShadow = '0 12px 0 #08212b';
            }
        }

        leftBtn.addEventListener('touchstart', (e) => {
            e.preventDefault();
            setButtonActive(leftBtn, true);
            ws.send({ type: 'mouse-down', button: 'left' });
        });
        leftBtn.addEventListener('touchend', (e) => {
            e.preventDefault();
            setButtonActive(leftBtn, false);
            ws.send({ type: 'mouse-up', button: 'left' });
        });
        leftBtn.addEventListener('touchcancel', (e) => {
            e.preventDefault();
            setButtonActive(leftBtn, false);
            ws.send({ type: 'mouse-up', button: 'left' });
        });

        rightBtn.addEventListener('touchstart', (e) => {
            e.preventDefault();
            setButtonActive(rightBtn, true);
            ws.send({ type: 'mouse-down', button: 'right' });
        });
        rightBtn.addEventListener('touchend', (e) => {
            e.preventDefault();
            setButtonActive(rightBtn, false);
            ws.send({ type: 'mouse-up', button: 'right' });
        });
        rightBtn.addEventListener('touchcancel', (e) => {
            e.preventDefault();
            setButtonActive(rightBtn, false);
            ws.send({ type: 'mouse-up', button: 'right' });
        });

        // å…¼å®¹é¼ æ ‡ï¼ˆå¼€å‘è°ƒè¯•ï¼‰
        leftBtn.addEventListener('mousedown', () => { setButtonActive(leftBtn, true); ws.send({ type: 'mouse-down', button: 'left' }); });
        leftBtn.addEventListener('mouseup', () => { setButtonActive(leftBtn, false); ws.send({ type: 'mouse-up', button: 'left' }); });
        leftBtn.addEventListener('mouseleave', () => { setButtonActive(leftBtn, false); ws.send({ type: 'mouse-up', button: 'left' }); });
        rightBtn.addEventListener('mousedown', () => { setButtonActive(rightBtn, true); ws.send({ type: 'mouse-down', button: 'right' }); });
        rightBtn.addEventListener('mouseup', () => { setButtonActive(rightBtn, false); ws.send({ type: 'mouse-up', button: 'right' }); });
        rightBtn.addEventListener('mouseleave', () => { setButtonActive(rightBtn, false); ws.send({ type: 'mouse-up', button: 'right' }); });

        // --- é”®ç›˜æŒ‰é’® (è§¦æ§) ---
        const keys = document.querySelectorAll('.key');
        keys.forEach(key => {
            // è§¦æ‘¸äº‹ä»¶
            key.addEventListener('touchstart', (e) => {
                e.preventDefault();
                const keyVal = key.dataset.key || '';
                key.style.transform = 'translateY(6px)';
                key.style.boxShadow = '0 2px 0 #102634';
                ws.send({ type: 'key-down', key: keyVal });
            });
            key.addEventListener('touchend', (e) => {
                e.preventDefault();
                const keyVal = key.dataset.key || '';
                key.style.transform = '';
                key.style.boxShadow = '0 7px 0 #102634, 0 6px 16px black';
                ws.send({ type: 'key-up', key: keyVal });
            });
            key.addEventListener('touchcancel', (e) => {
                e.preventDefault();
                key.style.transform = '';
                key.style.boxShadow = '0 7px 0 #102634, 0 6px 16px black';
                const keyVal = key.dataset.key || '';
                ws.send({ type: 'key-up', key: keyVal });
            });

            // é¼ æ ‡äº‹ä»¶ï¼ˆè°ƒè¯•ç”¨ï¼‰
            key.addEventListener('mousedown', () => {
                key.style.transform = 'translateY(6px)';
                key.style.boxShadow = '0 2px 0 #102634';
                ws.send({ type: 'key-down', key: key.dataset.key || '' });
            });
            key.addEventListener('mouseup', () => {
                key.style.transform = '';
                key.style.boxShadow = '0 7px 0 #102634, 0 6px 16px black';
                ws.send({ type: 'key-up', key: key.dataset.key || '' });
            });
            key.addEventListener('mouseleave', () => {
                if (key.style.transform === 'translateY(6px)') {
                    key.style.transform = '';
                    key.style.boxShadow = '0 7px 0 #102634, 0 6px 16px black';
                    ws.send({ type: 'key-up', key: key.dataset.key || '' });
                }
            });
        });

        // --- å®æŒ‡ä»¤ (è§¦æ§ä¼˜åŒ–) ---
        function macroTouchEffect(btn) {
            btn.style.transform = 'translateY(8px)';
            btn.style.boxShadow = '0 4px 0 #09303f';
            setTimeout(() => {
                btn.style.transform = '';
                btn.style.boxShadow = '0 12px 0 #09303f';
            }, 120);
        }

        screenshotBtn.addEventListener('touchstart', (e) => e.preventDefault());
        screenshotBtn.addEventListener('touchend', (e) => {
            e.preventDefault();
            macroTouchEffect(screenshotBtn);
            ws.send({ type: 'screenshot' });
        });
        lockBtn.addEventListener('touchend', (e) => {
            e.preventDefault();
            macroTouchEffect(lockBtn);
            ws.send({ type: 'lock' });
        });
        shutdownBtn.addEventListener('touchend', (e) => {
            e.preventDefault();
            if (confirm('å‘é€å…³æœºæŒ‡ä»¤ï¼Ÿ(æ¨¡æ‹Ÿ)')) {
                macroTouchEffect(shutdownBtn);
                ws.send({ type: 'shutdown' });
            }
        });

        // é¼ æ ‡ç‚¹å‡»å…¼å®¹
        screenshotBtn.addEventListener('click', () => { ws.send({ type: 'screenshot' }); });
        lockBtn.addEventListener('click', () => { ws.send({ type: 'lock' }); });
        shutdownBtn.addEventListener('click', () => { if (confirm('å…³æœºæ¨¡æ‹Ÿ?')) ws.send({ type: 'shutdown' }); });

        // --- æ¨¡æ‹Ÿæ•ˆæœ (è§†è§‰åé¦ˆ) ---
        function simulateEffect(msg) {
            const canvas = document.getElementById('screenCanvas');
            const ctx = canvas.getContext('2d');
            if (msg.type === 'screenshot') {
                ctx.fillStyle = 'white';
                ctx.globalAlpha = 0.4;
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                ctx.globalAlpha = 1;
                ctx.font = 'bold 70px system-ui';
                ctx.fillStyle = '#00ddff';
                ctx.fillText('ğŸ“¸', 550, 370);
                setTimeout(() => {
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    drawCanvasGrid(ctx);
                }, 300);
            } else if (msg.type === 'lock') {
                liveScreen.style.filter = 'brightness(0.4) blur(3px)';
                setTimeout(() => liveScreen.style.filter = '', 500);
            } else if (msg.type === 'shutdown') {
                document.body.style.opacity = '0.7';
                setTimeout(() => document.body.style.opacity = '1', 700);
            }
        }

        // æ›´æ–°å…‰æ ‡ (ä»æ¶ˆæ¯)
        function updateRemoteCursorFromMessage(msg) {
            if (msg.type === 'mouse-move' && msg.x !== undefined && msg.y !== undefined) {
                setCursorPosition(msg.x, msg.y);
            }
        }

        // ç»˜åˆ¶canvasç½‘æ ¼èƒŒæ™¯
        function drawCanvasGrid(ctx) {
            const w = ctx.canvas.width;
            const h = ctx.canvas.height;
            ctx.clearRect(0, 0, w, h);
            ctx.strokeStyle = '#1288aa';
            ctx.lineWidth = 0.5;
            for (let i = 0; i <= w; i += 50) {
                ctx.beginPath();
                ctx.moveTo(i, 0);
                ctx.lineTo(i, h);
                ctx.strokeStyle = '#20a0c0';
                ctx.stroke();
            }
            for (let i = 0; i <= h; i += 50) {
                ctx.beginPath();
                ctx.moveTo(0, i);
                ctx.lineTo(w, i);
                ctx.strokeStyle = '#20a0c0';
                ctx.stroke();
            }
            ctx.font = '26px system-ui, -apple-system';
            ctx.fillStyle = '#ccf0ff';
            ctx.fillText('iPad è¿œç¨‹ç”»é¢', 60, 100);
        }

        window.onload = () => {
            const canvas = document.getElementById('screenCanvas');
            const ctx = canvas.getContext('2d');
            drawCanvasGrid(ctx);
        };

        // é˜»æ­¢ä¸€åˆ‡é¡µé¢æ»šåŠ¨/ç¼©æ”¾ (ä¸ºäº†è§¦æ§æ¿ä¸å¹²æ‰°)
        document.body.addEventListener('touchmove', (e) => {
            if (e.target === touchSurface || e.target.closest('.touchpad-surface')) {
                e.preventDefault();
            }
        }, { passive: false });
        document.body.addEventListener('gesturestart', (e) => e.preventDefault());
    })();
</script>
</body>
</html>